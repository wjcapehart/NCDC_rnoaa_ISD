library("lubridate")
library("isdparser")
library("rnoaa")
library("openair")
stations_near_KRAP = isd_stations_search(lat=44,      # degrees_north
lon=-103,    # degrees_east
radius=100)  # km
print(stations_near_KRAP)
krap_usaf = 726620
krap_wban =  24090
krap_year =   2010
station_name_label = paste("Rapid City", krap_year)
KRAP_data = isd(usaf = krap_usaf,  # your usaf number
wban = krap_wban,  # your wban number
year = krap_year,  # your year
progress=TRUE)     # shows prograss as you go
KRAP_data$date_time = ymd_hm(sprintf("%s %s",
as.character(KRAP_data$date),
KRAP_data$time))
KRAP_data$date = KRAP_data$date_time
KRAP_data$temperature[KRAP_data$temperature == "+9999"]                   = NA
KRAP_data$temperature_dewpoint[KRAP_data$temperature_dewpoint == "+9999"] = NA
KRAP_data$air_pressure[KRAP_data$air_pressure == "99999"]                 = NA
KRAP_data$wind_speed[KRAP_data$wind_speed == "9999"]                     = NA
KRAP_data$wind_direction[KRAP_data$wind_direction == "999"]             = NA
KRAP_data = isd_transform(KRAP_data)
KRAP_data$GF1_total_cloud_cover_fraction = as.numeric(KRAP_data$GF1_coverage)
# 00: None, SKC or CLR
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==00] = 0.00
# 01: One okta - 1/10 or less but not zero
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==01] = 1.0 / 8.0
# 02: Two oktas - 2/10 ‑ 3/10, or FEW
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==02] = 2.0 / 8.0
# 03: Three oktas - 4/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==03] = 3.0 / 8.0
# 04: Four oktas - 5/10, or SCT
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==04] = 4.0 / 8.0
# 05: Five oktas - 6/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==05] = 5.0 / 8.0
# 06: Six oktas - 7/10 ‑ 8/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==06] = 6.0 / 8.0
# 07: Seven oktas - 9/10 or more but not 10/10, or BKN
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==07] = 7.0 / 8.0
# 08: Eight oktas - 10/10, or OVC
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==08] = 8.0 / 8.0
# 09: Sky obscured, or cloud amount cannot be estimated
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==09] = 8.0 / 8.0
# 10: Partial obscuration
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==10] = 4.0 / 8.0
# 11: Thin scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==11] = 2.0 / 8.0
# 12: Scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==12] = 4.0 / 8.0
# 13: Dark scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==13] = 5.0 / 8.0
# 14: Thin broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==14] = 6.0 / 8.0
# 15: Broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==15] = 7.0 / 8.0
# 16: Dark broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==16] = 8.0 / 8.0
# 17: Thin overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==17] = 4.0 / 8.0
# 18: Overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==18] = 8.0 / 8.0
# 19: Dark overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==19] = 8.0 / 8.0
# 99: Missing
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==99] = NA
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature,
type    = "l",
col     = "red",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Temperature (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature_dewpoint,
type    = "l",
col     = "darkgreen",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Dew Point (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$GF1_total_cloud_cover_fraction,
type    = "l",
col     = "grey",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Cloud Cover (fraction)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$air_pressure,
type    = "l",
col     = "blue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "MSL Pressure (mb)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$wind_speed,
type    = "l",
col     = "darkblue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Wind Speed (m s-1)",
main    = station_name_label)
windrose_frame =  na.omit(data.frame(date      = KRAP_data$date_time,
speed     = KRAP_data$wind_speed,
direction = KRAP_data$wind_direction))
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "year",
hemisphere = "northern",
main       = station_name_label)
windrose_frame = data.frame(date      = KRAP_data$date_time,
peed     = KRAP_data$wind_speed,
direction = KRAP_data$wind_direction)
windrose_frame <- windrose_frame[complete.cases(windrose_frame), ]
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "year",
hemisphere = "northern")
library("lubridate")
library("isdparser")
library("rnoaa")
library("openair")
stations_near_KRAP = isd_stations_search(lat=44,      # degrees_north
lon=-103,    # degrees_east
radius=100)  # km
print(stations_near_KRAP)
krap_usaf = 726620
krap_wban =  24090
krap_year =   2010
station_name_label = paste("Rapid City", krap_year)
KRAP_data = isd(usaf = krap_usaf,  # your usaf number
wban = krap_wban,  # your wban number
year = krap_year,  # your year
progress=TRUE)     # shows prograss as you go
KRAP_data$date_time = ymd_hm(sprintf("%s %s",
as.character(KRAP_data$date),
KRAP_data$time))
KRAP_data$date = KRAP_data$date_time
KRAP_data$temperature[KRAP_data$temperature == "+9999"]                   = NA
KRAP_data$temperature_dewpoint[KRAP_data$temperature_dewpoint == "+9999"] = NA
KRAP_data$air_pressure[KRAP_data$air_pressure == "99999"]                 = NA
KRAP_data$wind_speed[KRAP_data$wind_speed == "9999"]                     = NA
KRAP_data$wind_direction[KRAP_data$wind_direction == "999"]             = NA
KRAP_data = isd_transform(KRAP_data)
KRAP_data$GF1_total_cloud_cover_fraction = as.numeric(KRAP_data$GF1_coverage)
# 00: None, SKC or CLR
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==00] = 0.00
# 01: One okta - 1/10 or less but not zero
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==01] = 1.0 / 8.0
# 02: Two oktas - 2/10 ‑ 3/10, or FEW
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==02] = 2.0 / 8.0
# 03: Three oktas - 4/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==03] = 3.0 / 8.0
# 04: Four oktas - 5/10, or SCT
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==04] = 4.0 / 8.0
# 05: Five oktas - 6/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==05] = 5.0 / 8.0
# 06: Six oktas - 7/10 ‑ 8/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==06] = 6.0 / 8.0
# 07: Seven oktas - 9/10 or more but not 10/10, or BKN
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==07] = 7.0 / 8.0
# 08: Eight oktas - 10/10, or OVC
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==08] = 8.0 / 8.0
# 09: Sky obscured, or cloud amount cannot be estimated
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==09] = 8.0 / 8.0
# 10: Partial obscuration
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==10] = 4.0 / 8.0
# 11: Thin scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==11] = 2.0 / 8.0
# 12: Scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==12] = 4.0 / 8.0
# 13: Dark scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==13] = 5.0 / 8.0
# 14: Thin broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==14] = 6.0 / 8.0
# 15: Broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==15] = 7.0 / 8.0
# 16: Dark broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==16] = 8.0 / 8.0
# 17: Thin overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==17] = 4.0 / 8.0
# 18: Overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==18] = 8.0 / 8.0
# 19: Dark overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==19] = 8.0 / 8.0
# 99: Missing
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==99] = NA
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature,
type    = "l",
col     = "red",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Temperature (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature_dewpoint,
type    = "l",
col     = "darkgreen",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Dew Point (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$GF1_total_cloud_cover_fraction,
type    = "l",
col     = "grey",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Cloud Cover (fraction)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$air_pressure,
type    = "l",
col     = "blue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "MSL Pressure (mb)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$wind_speed,
type    = "l",
col     = "darkblue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Wind Speed (m s-1)",
main    = station_name_label)
windrose_frame = data.frame(date      = KRAP_data$date_time,
peed     = KRAP_data$wind_speed,
direction = KRAP_data$wind_direction)
windrose_frame <- windrose_frame[complete.cases(windrose_frame), ]
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "year",
hemisphere = "northern",
main       = station_name_label)
windrose_frame = data.frame(date      = KRAP_data$date_time,
speed      = KRAP_data$wind_speed,
direction = KRAP_data$wind_direction)
windrose_frame <- windrose_frame[complete.cases(windrose_frame), ]
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "year",
hemisphere = "northern",
main       = station_name_label)
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "season",
hemisphere = "northern",
main       = station_name_label)
windrose_frame = data.frame(date      = KRAP_data$date_time,
speed      = KRAP_data$wind_speed,
direction = KRAP_data$wind_direction)
windrose_frame <- windrose_frame[complete.cases(windrose_frame), ]
windRose(mydata     = windrose_frame,
ws         = "speed",
wd         = "direction",
type       = "year",
hemisphere = "northern",
main       = station_name_label)
library("lubridate")
library("isdparser")
library("rnoaa")
library("openair")
stations_near_KRAP = isd_stations_search(lat=44,      # degrees_north
lon=-103,    # degrees_east
radius=100)  # km
print(stations_near_KRAP)
krap_usaf = 726620
krap_wban =  24090
krap_year =   2010
station_name_label = paste("Rapid City",
krap_year)
output_file_name = paste("KRAP",
krap_year,
".csv",
sep="")
KRAP_data = isd(usaf = krap_usaf,  # your usaf number
wban = krap_wban,  # your wban number
year = krap_year,  # your year
progress=TRUE)     # shows prograss as you go
print(KRAP_data)
KRAP_data$date_time = ymd_hm(sprintf("%s %s",
as.character(KRAP_data$date),
KRAP_data$time))
KRAP_data$date = KRAP_data$date_time
KRAP_data$temperature[KRAP_data$temperature == "+9999"]                   = NA
KRAP_data$temperature_dewpoint[KRAP_data$temperature_dewpoint == "+9999"] = NA
KRAP_data$air_pressure[KRAP_data$air_pressure == "99999"]                 = NA
KRAP_data$wind_speed[KRAP_data$wind_speed == "9999"]                     = NA
KRAP_data$wind_direction[KRAP_data$wind_direction == "999"]             = NA
KRAP_data = isd_transform(KRAP_data)
# patch the wind direction so it's 0 degrees when the wind speed is missing
KRAP_data$wind_direction[KRAP_data$wind_speed == 0]             = 0
KRAP_data$GF1_total_cloud_cover_fraction = as.numeric(KRAP_data$GF1_coverage)
# 00: None, SKC or CLR
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==00] = 0.00
# 01: One okta - 1/10 or less but not zero
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==01] = 1.0 / 8.0
# 02: Two oktas - 2/10 ‑ 3/10, or FEW
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==02] = 2.0 / 8.0
# 03: Three oktas - 4/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==03] = 3.0 / 8.0
# 04: Four oktas - 5/10, or SCT
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==04] = 4.0 / 8.0
# 05: Five oktas - 6/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==05] = 5.0 / 8.0
# 06: Six oktas - 7/10 ‑ 8/10
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==06] = 6.0 / 8.0
# 07: Seven oktas - 9/10 or more but not 10/10, or BKN
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==07] = 7.0 / 8.0
# 08: Eight oktas - 10/10, or OVC
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==08] = 8.0 / 8.0
# 09: Sky obscured, or cloud amount cannot be estimated
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==09] = 8.0 / 8.0
# 10: Partial obscuration
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==10] = 4.0 / 8.0
# 11: Thin scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==11] = 2.0 / 8.0
# 12: Scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==12] = 4.0 / 8.0
# 13: Dark scattered
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==13] = 5.0 / 8.0
# 14: Thin broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==14] = 6.0 / 8.0
# 15: Broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==15] = 7.0 / 8.0
# 16: Dark broken
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==16] = 8.0 / 8.0
# 17: Thin overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==17] = 4.0 / 8.0
# 18: Overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==18] = 8.0 / 8.0
# 19: Dark overcast
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==19] = 8.0 / 8.0
# 99: Missing
KRAP_data$GF1_total_cloud_cover_fraction[KRAP_data$GF1_total_cloud_cover_fraction==99] = NA
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature,
type    = "l",
col     = "red",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Temperature (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$temperature_dewpoint,
type    = "l",
col     = "darkgreen",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Dew Point (deg C)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$GF1_total_cloud_cover_fraction,
type    = "l",
col     = "grey",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Cloud Cover (fraction)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$air_pressure,
type    = "l",
col     = "blue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "MSL Pressure (mb)",
main    = station_name_label)
plot(x       = KRAP_data$date_time,
y       = KRAP_data$wind_speed,
type    = "l",
col     = "darkblue",
lwd     = 1.5,
cex.lab = 1.25,
xlab    = "Date",
ylab    = "Wind Speed (m s-1)",
main    = station_name_label)
windrose_frame = data.frame(date      = KRAP_data$date_time,
ws        = KRAP_data$wind_speed,
wd        = KRAP_data$wind_direction,
longitude = KRAP_data$longitude,
latitude  = KRAP_data$latitude)
windRose(mydata     = windrose_frame,
ws         = "ws",
wd         = "wd",
type       = "year",
hemisphere = "northern",
main       = station_name_label)
windRose(mydata     = windrose_frame,
ws         = "ws",
wd         = "wd",
type       = "season",
hemisphere = "northern",
main       = station_name_label)
start_date = as.POSIXct(paste(krap_year,
"-01-01 00:00:00 UTC",
sep=""),
tz = "UTC")
end_date   = as.POSIXct(paste(krap_year,
"-12-31 00:00:00 UTC",
sep=""),
tz = "UTC")
hour_time = seq.POSIXt(from = start_date,
to   = end_date,
by   = "1 hour",
tz   = "UTC")
KRAP_time_series                  = data.frame(date = hour_time)
KRAP_time_series$temperature_degC = approx(x      = KRAP_data$date_time,
y      = KRAP_data$temperature,
method = "linear",
xout   = hour_time)$y
KRAP_time_series$dewpoint_degC    = approx(x      = KRAP_data$date_time,
y      = KRAP_data$temperature_dewpoint,
method = "linear",
xout   = hour_time)$y
KRAP_time_series$cloud_fraction   = approx(x      = KRAP_data$date_time,
y      = KRAP_data$GF1_total_cloud_cover_fraction,
method = "linear",
xout   = hour_time)$y
KRAP_time_series$press_msl_hPa    = approx(x      = KRAP_data$date_time,
y      = KRAP_data$air_pressure,
method = "linear",
xout   = hour_time)$y
KRAP_time_series$wind_spd_ms      = approx(x      = KRAP_data$date_time,
y      = KRAP_data$wind_speed,
method = "linear",
xout   = hour_time)$y
KRAP_time_series$wind_dir_degrees  = approx(x     = KRAP_data$date_time,
y      = KRAP_data$wind_direction,
method = "linear",
xout   = hour_time)$y
print(KRAP_time_series)
write.table(x    = KRAP_time_series,
file = output_file_name,
sep  =", ",
row.names = FALSE)
